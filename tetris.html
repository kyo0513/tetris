<!DOCTYPE html>
<html>
<head>
    <meta cahrset="UTF-8" >
    <title>テトリス</title>
    <style>
        body{
            background:#ddf5ff;
        }
        #container{
            margin:0 auto;
        }
    </style>
</head>
<body onload="init()">
    <div id="container">
        <canvas id="cvs"></canvas>
    </div>
    <script>
        const blockSize=30;
        const boardRow =20;
        const boardCol =10;

        const cvs =document.getElementById("cvs");
        const ctx=cvs.getContext("2d");

        const canvasW = blockSize * boardCol;
        const canvasH = blockSize * boardRow;

        cvs.width=canvasW;
        cvs.height=canvasH;

        const container = document.getElementById("container");
        container.style.width = canvasW + 'px';

        const tetSize=4;
        //T型
        let tet=[
            [0,0,0,0],
            [0,1,0,0],
            [1,1,1,0],
            [0,0,0,0],

        ];

        let offsetX =0;
        let offsetY =0;

        const board=[];

        //描画処理
        const draw=()=>{
            ctx.fillStyle = "#000";
            ctx.fillRect(0,0,canvasW,canvasH);
            //追記1
            //ctx.fillStyle="#f00";
            //ctx.fillRect(150,150,blockSize,blockSize);

        //ボードに存在しているものを塗る
        for(let y=0; y< boardRow;y++){
            for(let x=0; x< boardCol;x++){
                if(board[y][x]){
                    drawBlock(x,y);
                }
            }
        }

            for(let y=0; y < tetSize;y++){
                for(let x =0; x < tetSize; x++){
                    if(tet[y][x]){
                        drawBlock(offsetX+x,offsetY+y);
                        //ctx.fillRect(x * blockSize,y * blockSize,blockSize,blockSize);
                        //ctx.fillRect(
                        //    (offsetX+x)*blockSize,
                        //    (offsetY+y)*blockSize,
                        //    blockSize,
                        //    blockSize);
                    }
                }
            }
        }
        const drawBlock =(x,y) =>{
            let px = x * blockSize;
            let py = y * blockSize;

            ctx.fillStyle ="#f00";
            ctx.fillRect(px,py,blockSize,blockSize);
            ctx.strokStyle="black";
            ctx.strokeRect(px,py,blockSize,blockSize);
        }

        const canMove =(dx,dy)=>{
            for(let y=0;y<tetSize;y++){
                for(let x=0;x<tetSize;x++){
                    if(tet[y][x]){
                        let nx = offsetX + x + dx;
                        let ny = offsetY + y + dy;
                        if(
                            ny < 0 ||
                            nx < 0 ||
                            ny >= boardRow ||
                            nx >= boardCol ||
                            board[ny][nx]
                        ){
                            return false;
                        }
                    }
                }
            }
            return true;
        };

        document.onkeydown = (e) =>{
        switch (e.keyCode) {
          case 37: //左
            //offsetX--;
            if(canMove(-1,0)) offsetX--;
            break;
          case 38: //上
            if(canMove(0,-1)) offsetY--;
            break;
          case 39: //右
            if(canMove(1,0)) offsetX++;
            break;
          case 40: //下
            if(canMove(0,1)) offsetY++;
            break;
        }
        draw();
      };


        const init =()=>{
            for(let y=0; y< boardRow;y++){
                board[y]=[];
                for(let x=0; x<boardCol;x++){
                    board[y][x] =0;
                }
            }
            board[3][5]=1;   //テスト用
            draw();
        }


    </script>
</body>
</html>